<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Goot</title>
  <!-- Favicon using the provided base64 PNG image data -->
   <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/5YAAP+WAAH/lgAO/5YAIf+WACH/lgAO/5YAAf+WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/lgAA/5YAAP+WAB//lgB7/5gAwv+ZAN3/mQDd/5gAwv+WAHv/lgAf/5YAAP+WAAAAAAAAAAAAAAAAAAD/lgAA/5YAAP+WAD3/lgDN+JIA/9h/AP+7bgD/u24A/9h/AP/4kgD//5YAzv+WAD3/lgAA/5YAAAAAAAD//wAA/5gAAP+dACr/lwDU95EA/5dZAP+JUAD/p2IA/6diAP+JUAD/l1kA//eRAP//lwDU/50AKv+YAAD//wAAAAAAAwAAAE9tQAC98Y4A//2VAP/rigD//JUA//+YAP//mAD//JUA/+uKAP/9lQD/8Y4A/21AAL4AAABQAAAAAwAAAB4AAADXCAUA/7ltAP//mAD//5cA//+WAP//lgD//5YA//+WAP//lwD//5gA/7ltAP4IBQD/AAAA1wAAAB4AAAAlAAAA4AMCAP+vZwD//5kA//+WAP//lgD//5YA//+WAP//lgD//5YA//+ZAP+vZwD+AwIA/wAAAOAAAAAkAAAAJAAAAOADAgD/r2cA//+ZAP//lgD//5YA//+WAP//lgD//5YA//+WAP//mQD/r2cA/gMCAP8AAADgAAAAJQAAACQAAADgBAIA/69nAP7/mQD//5YA//+WAP//lgD//5YA//+WAP//lgD//5kA/69nAP4EAgD/AAAA4AAAACUAAAAWAAAAxBUMAP/GdQD//5gA//+WAP//lgD//5YA//+WAP//lgD//5YA//+YAP/GdQD/FQwA/wAAAMUAAAAWAAAAAAAAAERWMwDI/JQA9P+WAP//lgD//5YA//+WAP//lgD//5YA//+WAP//lgD//JQA9FYzAMgAAABEAAAAAAAAAAAAAAAVDwkAhu2NAJP/lgD5/5YA//+WAP//lgD//5YA//+WAP//lgD//5YA+e2NAJMPCQCGAAAAFQAAAAAAAAAAAAAAAAAAAGkfEwBR/50AaP+XANb/lgD7/5YA//+WAP//lgD7/5cA1v+dAGggEwBRAAAAaQAAAAAAAAAAAAAAAAAAAAAAAAAXAAAAfwIBAFWJUAA2848AWP+WAHb/lgB2848AWIlRADYDAQBVAAAAfwAAABcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAABWAAAAegAAAHUAAABsAAAAbAAAAHUAAAB6AAAAVgAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAcAAAAKQAAACkAAAAcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAA+B8AAPAPAADgBwAAwAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAMADAADgBwAA+B8AAA==">
  <!-- Rest of your head content -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --glass-bg: rgba(25, 35, 60, 0.55);
      --btn-bg: rgba(15, 20, 35, 0.8);
      --btn-bg-hover: rgba(30, 40, 65, 0.9);
      --remove-btn-bg: rgba(35, 45, 70, 0.7);
      --playlist-bg: rgba(20, 30, 50, 0.6);
      --active-playlist: rgba(60, 80, 120, 0.8);
    }
    body {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(to bottom, #0b0b0b, #1a1a1a);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .container {
      width: 95%; max-width: 1200px; padding: 30px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: 24px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      text-align: center;
      position: relative; /* To contain absolutely positioned elements */
    }

.main-content {
  display: flex;
  gap: 20px;
  /* Remove align-items: flex-start; */
}

.player-section {
  flex: 2;
  min-width: 0;
  display: flex;       /* Make player-section a flex container */
  flex-direction: column; /* Stack children vertically */
}

.playlist-section {
  flex: 1;
  min-width: 280px;
  background: var(--playlist-bg);
  border-radius: 16px;
  padding: 20px;
  backdrop-filter: blur(10px);
  /* Allow it to grow and fill available space within player-section */
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

/* Ensure the playlist content area takes up remaining space */
.playlist-section > div:not(.current-playlist-header):not(.playlist-controls):not(.playlist-input) {
  flex-grow: 1;
  /* Add overflow handling if content exceeds */
  overflow-y: auto;
}

    iframe {
      border-radius: 16px;
      margin: 20px 0;
      max-width: 100%;
      display: none; /* Hide the YouTube video player */
    }

    .audio-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    .control-btn {
      background: rgba(40, 50, 70, 0.8);
      border: 1px solid rgba(60, 70, 90, 0.6);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      padding: 10px;
      min-width: 36px;
      min-height: 36px;
    }

    .control-btn:hover {
      background: rgba(50, 60, 80, 0.9);
      border-color: rgba(80, 90, 110, 0.8);
    }

    .control-btn svg {
      width: 16px;
      height: 16px;
      fill: white;
    }

    .playback-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .track-info {
      text-align: center;
      flex: 1;
      min-width: 0;
    }

    .track-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-status {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    #nowPlaying {
      margin: 10px 0;
      font-size: 18px;
      font-weight: 600;
    }

    .button {
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      border: none;
      background: var(--btn-bg);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .button:hover {
      background: var(--btn-bg-hover);
      transform: translateY(-1px);
    }

    .button.small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .remove-btn {
      margin-left: 10px;
      padding: 4px 8px;
      background: var(--remove-btn-bg);
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s ease;
    }

    .remove-btn:hover {
      background: rgba(220, 50, 50, 0.8);
    }

    .queue-item {
      display: flex;
      align-items: center;
      padding: 8px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .queue-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .queue-item.current {
      font-weight: bold;
      background: rgba(100, 150, 255, 0.2);
      border-left: 4px solid #4CAF50;
    }

    .playlist-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .playlist-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .playlist-item.active {
      background: var(--active-playlist);
      border-left: 4px solid #FFD700;
    }

    .playlist-controls {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .playlist-input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      width: 100%;
      margin-bottom: 10px;
    }

    .playlist-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .url-input-container {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    #urlInput {
      flex: 1;
      min-width: 300px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    #urlInput::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    /* Style for the version text */
    #versionText {
      position: absolute;
      bottom: 10px;
      right: 15px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
    }

    .file-input {
      display: none;
    }

    .current-playlist-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #FFD700;
    }

    .queue-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }

      .url-input-container {
        flex-direction: column;
      }

      #urlInput {
        min-width: auto;
      }

      .playlist-controls {
        flex-direction: column;
      }

      /* Adjust version text position for smaller screens if needed */
      #versionText {
        bottom: 5px;
        right: 10px;
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
    <div class="container" id="playerContainer">
    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
      <!-- Image inserted here -->
      <img src="data:image/png;base64,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ymudgtu0midfHkqxuMoUSYhjRBLgiV1el0HzKm4+iYXPMnwU077Ift9gyqGM3JFc6oobPOx3UrMM2gqsXsrCZ/j3PSx4guZGdj6Yix5ixOhylvMIzsaKMqn3n2pjsytXivT4GSL/bkMlGFrP7iey/C3WLOel+3jtL4ydxtRDmXoYE/Zk5ATqRpDtUI1CGy1NfPg+78/lrTnxWfYG+TQk1G/PbidEWd1DeTutc9k3b531S2VqT3I+W7z0367La9taeecFnr+L1x5m1XvtZp8bwrZjaZjM9lMCUK6mHcpHi1mxkJWLWLOMdelImsmy3QRmHsdBZ7HTgcpM4FaLpOffIqnUWjYeTDucISJF5CrdbX3JYl2eZQt4/THmP87iVyIto63CPQ+5WrYZGxY2/UhmHM2O06kZUi6ot+AX+CXWbgyUnoFphzNCJBxfav1teV2XsraZxrd5by7v/osl88JdWlaHhRVB1I1k5DjGzeQz+zJxTxp2CrehkpForbDoa9C0sVB6C4Z453uZMNf6iu4tjoOFJOJFSxOtTWFZUFPLkHrq6qkdRjatYuVDfrPY43CdyGIvt9epimDWB1SHc4X1jK9aDXr2HLZUuM9t+KQnQKoDph1OFkeK6fVB+n85IxGz2J/hr2jrDZTqgGmHQ+xYuxjniBy3/tAKsXt2thiae+Q6fQNmfUC1YlvOBSJ1vaGPgKwSuXO3ih27rdUA0jdg2uEQw/iB+KZIdpyk99t11on098fFHsznFDeCVhFK34DZEFItdhL7mA4XOW8TRRJ1OVBtYpK2GC+JvZBPic0e+WrD6D8w6wMqQhqTgpoitsk0iJ1oQ8Wg3JLCWCVixptiuXW54gNsHwLpXzDlgZX+VykFxVlLPwDYqq3aqj7V/wGCmneyIS3begAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNS0wOC0yMVQxMTozNzo0NyswMDowME6q+B4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjUtMDgtMjFUMTE6Mzc6NDcrMDA6MDA/90CiAAAAIHRFWHRzb2Z0d2FyZQBodHRwczovL2ltYWdlbWFnaWNrLm9yZ7zPHZ0AAAAYdEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAYdEVYdFRodW1iOjpJbWFnZTo6SGVpZ2h0ADE5MkBdcVUAAAAXdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgAMTky06whCAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNzU1Nzc2MjY3Tlgf3AAAAA90RVh0VGh1bWI6OlNpemUAMEJClKI+7AAAAFZ0RVh0VGh1bWI6OlVSSQBmaWxlOi8vL21udGxvZy9mYXZpY29ucy8yMDI1LTA4LTIxL2VlODAwNjBlZWVmNWM4M2UyYjllZDI0M2Q5ZTAxMjczLmljby5wbmdLJRxjAAAAAElFTkSuQmCC" alt="Goot Logo" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 15px;">
      <h1 style="margin: 0;">goot</h1>
    </div>
    <div id="nowPlaying">Now Playing: None</div>
    <div class="main-content">
      <div class="player-section">
        <div id="player"></div>

        <div class="audio-controls">
          <div class="playback-controls">
            <!-- Original Inline SVGs -->
            <button class="control-btn" onclick="previousSong()" title="Previous Track" aria-label="Previous track">
              <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Left-pointing arrow -->
                <polygon points="19 4 9 12 19 20 19 4"/>
                <!-- Vertical bar (track end indicator) on the left -->
                <line x1="6" y1="4" x2="6" y2="20" />
              </svg>
            </button>

            <button class="control-btn" onclick="rewind10()" title="Rewind 10 seconds">
              <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Double rewind arrows -->
                <polygon points="11 19 2 12 11 5 11 19"/>
                <polygon points="22 19 13 12 22 5 22 19"/>
              </svg>
            </button>

            <button class="control-btn" id="playPauseBtn" onclick="togglePlayPause()" title="Play/Pause">
              <svg viewBox="0 0 24 24" id="playIcon">
                <polygon points="5,3 19,12 5,21"></polygon>
              </svg>
              <svg viewBox="0 0 24 24" id="pauseIcon" style="display: none;">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
              </svg>
            </button>

            <button class="control-btn" onclick="forward10()" title="Forward 10 seconds">
              <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Double forward arrows -->
                <polygon points="2 5 11 12 2 19 2 5"/>
                <polygon points="13 5 22 12 13 19 13 5"/>
              </svg>
            </button>

            <button class="control-btn" onclick="skipSong()" title="Skip to Next Song">
              <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Single forward arrow -->
                <polygon points="5 4 15 12 5 20 5 4"/>
                <!-- Vertical bar (like end of a timeline) -->
                <line x1="18" y1="4" x2="18" y2="20" />
              </svg>
            </button>
          </div>

          <div class="track-info">
            <div class="track-title" id="trackTitle">No track selected</div>
            <div class="track-status" id="trackStatus">Ready to play</div>
          </div>
        </div>

        <div class="url-input-container">
          <input id="urlInput" type="text" placeholder="Paste YouTube URL or search query">
          <button class="button" onclick="addUrl()">Add URL</button>
          <button class="button" onclick="searchAndAdd()">Search & Add</button>
        </div>

        <div class="queue-header">
          <h3>üé∂ Current Queue</h3>
          <button class="button small" onclick="clearQueue()">Clear Queue</button>
          <button class="button small" onclick="shuffleQueue()">Shuffle</button>
        </div>

        <div id="queue"></div>
      </div>

      <div class="playlist-section">
        <h3>üìö Playlists</h3>

        <div class="current-playlist-header" id="currentPlaylistHeader">
          <strong>Current: Default Queue</strong>
        </div>

        <input type="text" class="playlist-input" id="newPlaylistName" placeholder="New playlist name">

        <div class="playlist-controls">
          <button class="button small" onclick="saveCurrentAsPlaylist()">Save Queue As Playlist</button>
          <button class="button small" onclick="exportPlaylist()">Export</button>
          <button class="button small" onclick="importPlaylist()">Import</button>
        </div>

        <input type="file" class="file-input" id="playlistFileInput" accept=".goot" onchange="handlePlaylistImport(event)">

        <div id="playlistList"></div>
      </div>
    </div>

    <!-- Version Text -->
    <div id="versionText">v1.0.0</div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const YOUTUBE_API_KEY = 'AIzaSyCetwKQm5Qn1uEs7ml9wNBwBgOgf-PSm7U';

    let player;
    let queue = [];
    let currentIndex = -1;
    let playlists = {};
    let currentPlaylistName = "Default Queue";
    let isPlaying = false;
    let playerReady = false;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '1',
        width: '1',
        videoId: '',
        playerVars: {
          'playsinline': 1,
          'controls': 0,
          'disablekb': 1,
          'fs': 0,
          'modestbranding': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      playerReady = true;
      loadPlaylists();
      addPreset("AdziMKGvIbs");
      updatePlayPauseButton();
    }

    function onPlayerStateChange(event) {
      isPlaying = (event.data === YT.PlayerState.PLAYING);
      updatePlayPauseButton();
      updateTrackStatus();

      if (event.data === YT.PlayerState.ENDED) {
        skipSong(); // Use the updated skipSong function
      }
    }

    function togglePlayPause() {
      if (!playerReady || currentIndex < 0 || !queue[currentIndex]) {
        if (queue.length > 0) {
          currentIndex = 0;
          player.loadVideoById(queue[currentIndex].id);
          updateNowPlaying();
          updateTrackInfo();
        }
        return;
      }

      if (isPlaying) {
        player.pauseVideo();
      } else {
        player.playVideo();
      }
    }

    function updatePlayPauseButton() {
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');

      if (isPlaying) {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      } else {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      }
    }

    function updateTrackInfo() {
      const titleEl = document.getElementById('trackTitle');
      const statusEl = document.getElementById('trackStatus');

      if (currentIndex >= 0 && queue[currentIndex]) {
        titleEl.textContent = queue[currentIndex].title;
        updateTrackStatus();
      } else {
        titleEl.textContent = 'No track selected';
        statusEl.textContent = 'Ready to play';
      }
    }

    function updateTrackStatus() {
      const statusEl = document.getElementById('trackStatus');
      if (currentIndex >= 0 && queue[currentIndex]) {
        if (isPlaying) {
          statusEl.textContent = 'Now Playing';
        } else {
          statusEl.textContent = 'Paused';
        }
      }
    }

    // --- Updated Navigation Functions ---
    // Go to next song in the queue
    function skipSong() {
      if (queue.length === 0) return;

      if (currentIndex < queue.length - 1) {
        currentIndex++;
        player.loadVideoById(queue[currentIndex].id);
        updateNowPlaying();
        updateTrackInfo();
      }
      // Optional: loop back to start
      // else {
      //   currentIndex = 0;
      //   player.loadVideoById(queue[0].id);
      //   updateNowPlaying();
      //   updateTrackInfo();
      // }
    }

    // Go to previous song in the queue
    function previousSong() {
      if (queue.length === 0) return;

      if (currentIndex > 0) {
        currentIndex--;
        player.loadVideoById(queue[currentIndex].id);
        updateNowPlaying();
        updateTrackInfo();
      } else {
        // If at the first song, restart it
        player.seekTo(0);
        player.playVideo();
      }
    }
    // --- End Updated Navigation Functions ---

    function rewind10() {
      if (playerReady && player.getCurrentTime) {
        const currentTime = player.getCurrentTime();
        const newTime = Math.max(0, currentTime - 10);
        player.seekTo(newTime, true);
      }
    }

    function forward10() {
      if (playerReady && player.getCurrentTime && player.getDuration) {
        const currentTime = player.getCurrentTime();
        const duration = player.getDuration();
        const newTime = Math.min(duration, currentTime + 10);
        player.seekTo(newTime, true);
      }
    }

    // Playlist Management Functions
    function loadPlaylists() {
      const saved = JSON.parse(localStorage.getItem('gootPlaylists') || '{}');
      playlists = saved;
      renderPlaylists();
    }

    function savePlaylists() {
      localStorage.setItem('gootPlaylists', JSON.stringify(playlists));
    }

    function createPlaylist() {
      const name = document.getElementById('newPlaylistName').value.trim();
      if (!name) {
        alert('Please enter a playlist name');
        return;
      }
      if (playlists[name]) {
        alert('Playlist already exists');
        return;
      }

      playlists[name] = {
        name: name,
        songs: [],
        created: new Date().toISOString()
      };

      savePlaylists();
      renderPlaylists();
      document.getElementById('newPlaylistName').value = '';
    }

    function saveCurrentAsPlaylist() {
      const name = document.getElementById('newPlaylistName').value.trim();
      if (!name) {
        alert('Please enter a playlist name');
        return;
      }

      playlists[name] = {
        name: name,
        songs: [...queue],
        created: new Date().toISOString()
      };

      savePlaylists();
      renderPlaylists();
      document.getElementById('newPlaylistName').value = '';
      alert(`Playlist "${name}" saved with ${queue.length} songs!`);
    }

    function loadPlaylist(playlistName) {
      if (!playlists[playlistName]) return;

      currentPlaylistName = playlistName;
      queue = [...playlists[playlistName].songs];
      currentIndex = -1;

      updateCurrentPlaylistHeader();
      updateNowPlaying();
      renderPlaylists();

      if (queue.length > 0) {
        currentIndex = 0;
        player.loadVideoById(queue[0].id);
        updateNowPlaying();
        updateTrackInfo();
      }
    }

    function deletePlaylist(playlistName) {
      if (confirm(`Are you sure you want to delete "${playlistName}"?`)) {
        delete playlists[playlistName];
        savePlaylists();
        renderPlaylists();

        if (currentPlaylistName === playlistName) {
          currentPlaylistName = "Default Queue";
          updateCurrentPlaylistHeader();
        }
      }
    }

    function exportPlaylist() {
      const name = prompt("Enter playlist name to export:");
      if (!name || !playlists[name]) {
        alert('Playlist not found');
        return;
      }

      const playlistData = {
        ...playlists[name],
        exportedAt: new Date().toISOString(),
        version: "1.0"
      };

      const dataStr = JSON.stringify(playlistData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});

      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = `${name.replace(/[^a-z0-9]/gi, '_')}_playlist.goot`;
      link.click();
    }

    function importPlaylist() {
      document.getElementById('playlistFileInput').click();
    }

    function handlePlaylistImport(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const playlistData = JSON.parse(e.target.result);

          if (!playlistData.name || !playlistData.songs) {
            alert('Invalid .goot playlist file format');
            return;
          }

          let importName = playlistData.name;
          let counter = 1;
          while (playlists[importName]) {
            importName = `${playlistData.name} (${counter})`;
            counter++;
          }

          playlists[importName] = {
            name: importName,
            songs: playlistData.songs,
            created: new Date().toISOString(),
            imported: true
          };

          savePlaylists();
          renderPlaylists();
          alert(`Playlist "${importName}" imported successfully with ${playlistData.songs.length} songs!`);

        } catch (err) {
          alert('Error reading .goot playlist file');
          console.error('Import error:', err);
        }
      };
      reader.readAsText(file);

      // Reset input
      event.target.value = '';
    }

    function renderPlaylists() {
      const container = document.getElementById('playlistList');
      container.innerHTML = '';

      Object.values(playlists).forEach(playlist => {
        const div = document.createElement('div');
        div.className = 'playlist-item';
        if (playlist.name === currentPlaylistName) {
          div.classList.add('active');
        }

        div.innerHTML = `
          <div>
            <strong>${playlist.name}</strong><br>
            <small>${playlist.songs.length} songs</small>
          </div>
          <div>
            <button class="remove-btn" onclick="deletePlaylist('${playlist.name}')">üóëÔ∏è</button>
          </div>
        `;

        div.onclick = (e) => {
          if (e.target.classList.contains('remove-btn')) return;
          loadPlaylist(playlist.name);
        };

        container.appendChild(div);
      });
    }

    function updateCurrentPlaylistHeader() {
      const header = document.getElementById('currentPlaylistHeader');
      header.innerHTML = `<strong>Current: ${currentPlaylistName}</strong>`;
    }

    // Enhanced Queue Functions
    function clearQueue() {
      if (confirm('Clear the entire queue?')) {
        queue = [];
        currentIndex = -1;
        currentPlaylistName = "Default Queue";
        updateCurrentPlaylistHeader();
        updateNowPlaying();
        updateTrackInfo();
        player.stopVideo();
      }
    }

    function shuffleQueue() {
      if (queue.length <= 1) return;

      const currentSong = currentIndex >= 0 ? queue[currentIndex] : null;

      // Fisher-Yates shuffle
      for (let i = queue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [queue[i], queue[j]] = [queue[j], queue[i]];
      }

      // Find current song's new position
      if (currentSong) {
        currentIndex = queue.findIndex(song => song.id === currentSong.id);
      }

      currentPlaylistName = "Default Queue (Shuffled)";
      updateCurrentPlaylistHeader();
      renderQueue();
    }

    // Original Functions (Enhanced)
    async function addPreset(videoId) {
      const url = `https://www.youtube.com/watch?v=${videoId}`;
      let title = await fetchVideoTitle(url);
      if (!title) title = `Video ${videoId}`;
      enqueue(videoId, { title });
    }

    async function addUrl(){
      const url = document.getElementById("urlInput").value;
      const videoId = extractVideoID(url);
      if (!videoId) return alert("Invalid YouTube URL");

      let title = await fetchVideoTitle(url);
      if(!title) title = `Video ${videoId}`;

      enqueue(videoId, { title });
      document.getElementById("urlInput").value = '';

      currentPlaylistName = "Default Queue";
      updateCurrentPlaylistHeader();
    }

    async function searchAndAdd(){
      const query = document.getElementById("urlInput").value;
      if(!query) return alert("Enter a search query");

      try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}`);
        const data = await response.json();

        if(data.items && data.items.length > 0){
          const video = data.items[0];
          const videoId = video.id.videoId;
          const title = video.snippet.title;

          enqueue(videoId, { title });
        } else {
          alert('No results found');
        }
      } catch(err){
        console.error('Search failed:', err);
        alert('Search failed');
      }

      document.getElementById("urlInput").value = '';
      currentPlaylistName = "Default Queue";
      updateCurrentPlaylistHeader();
    }

    function extractVideoID(url){
      const regex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?|shorts)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    async function fetchVideoTitle(url){
      try {
        const oEmbedUrl = `https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`;
        const response = await fetch(oEmbedUrl);
        if(!response.ok) throw new Error('Video not found');
        const data = await response.json();
        return data.title;
      } catch (err) {
        console.warn('Error fetching video title:', err);
        return null;
      }
    }

    function enqueue(videoId, meta = {}){
      const item = {
        id: videoId,
        title: meta.title,
        thumb: meta.thumb || `https://i.ytimg.com/vi/${videoId}/default.jpg`,
        addedAt: new Date().toISOString()
      };
      queue.push(item);
      renderQueue();
    }

    function renderQueue(){
      const container = document.getElementById("queue");
      container.innerHTML = '';
      queue.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = 'queue-item';
        if(index === currentIndex) div.classList.add('current');

        div.innerHTML = `
          <img src="${item.thumb}" style="width:50px;height:38px;object-fit:cover;margin-right:10px;border-radius:6px;">
          <div style="flex:1;text-align:left;min-width:0;">
            <div style="font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${item.title}</div>
          </div>
        `;

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.innerText = 'üóëÔ∏è';
        removeBtn.onclick = (e) => {
          e.stopPropagation();
          removeSong(index);
        };

        div.appendChild(removeBtn);
        div.onclick = () => {
          currentIndex = index;
          player.loadVideoById(item.id);
          updateNowPlaying();
          updateTrackInfo();
        };

        container.appendChild(div);
      });
    }

    function removeSong(index){
      queue.splice(index, 1);
      if(currentIndex === index){
        if(queue.length > 0){
          currentIndex = index >= queue.length ? queue.length - 1 : index;
          player.loadVideoById(queue[currentIndex].id);
          updateTrackInfo();
        } else {
          currentIndex = -1;
          player.stopVideo();
          updateTrackInfo();
        }
      } else if(index < currentIndex){
        currentIndex--;
      }
      updateNowPlaying();
    }

    function updateNowPlaying(){
      const now = document.getElementById('nowPlaying');
      if(currentIndex >=0 && queue[currentIndex]) {
        now.textContent = `Now Playing: ${queue[currentIndex].title}`;
      } else {
        now.textContent = 'Now Playing: None';
      }
      renderQueue();
    }
  </script>
</body>
</html>
